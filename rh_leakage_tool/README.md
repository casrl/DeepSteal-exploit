# RowHammer Leakage Test

This is a tool that performs **DRAM bit leakage test** using the rowhammer attack as a side channel. The key observation is that a vulnerable DRAM cell typically only flip its state (i.e., **0&rarr;1** or **1&rarr;0**) when its *upper and/or lower bit in the same column* are set with certain states (i.e., column-wise data pattern dependence). For instance, in a double-sided rowhammer, a vulnerable DRAM cell may only exhibit a bit flip from **0&rarr;1** if the aforementioned two neighboring bits are set to **1** (i.e., a **1-0-1** layout).

This tool takes as inputs two bit flip profiles: one listing the physical pages and the corresponding page bit offset where bit can flip from **0&rarr;1**; and the other listing such records for bits that can flip from **1&rarr;0**. It determines *strongly leakable* and *weakly leakable* bits for each of the flippable bits from bitflip profile. At a high level, this test performs the following steps:
- It performs a *re-templating* to classify vulnerable cells based on what data pattern can lead to the bit flip. 
> For instance, **STRONG_XYX** represents that the bit in the middle row would flip **if and only if** its same-column aggressor bits are set to the opposite. This is considered as strongly leakable cells when using double-sided rowhammer. Similarly, **WEAK_XYX_ANY** represents a wealy-leakable cell that will flip if any of the same-column aggressor bits is set to opposite (e.g., **1-0-?** or **?-0-1**).
- It randomly selects certain number of pages that are leakable (e.g., using strongly leakable cells) and setup memory layout for leakage test. 
> The bits to steal (e.g., the top same-column aggressor bit) are configured with random values. The tool then uses **double-sided rowhammer** with proper setting of the middle and lower same-column bits to infer (steal) the upper bit (i.e., **based on whether or not a flip is observed in the middle bit**). Note that all other unrelated bits in the three rows are set with random values.
- The tool runs the leakage test for the random set of pages a couple of times and report the **bit leakage accuracy**.

Two example bit flip profiles are included in this folder: **bfp_example_0.dat** is the bit flip profile for **1&rarr;0 flip** and **bfp_example_1.dat** is the bit flip profile for **0&rarr;1 flip**. ```These need to be replaced with the actual bit flip profiles for the system under test.```
Some of the rowhammer attack constructs are based on [rowhammerjs](https://github.com/IAIK/rowhammerjs).
## Compiling

### Supported architecture:
 - Ivy bridge: ```ivy```
 - Sandy bridge: ```sandy```
 - Haswell: ```haswell```
 - Skylake: ```skylake```

First compile the tool for specific architecture.

```bash
make rh-leakage-$arch
```

E.g., for Haswell, run *make rh-leakage-haswell*


## Usage

### Command-line options
>
    -d: number of dimms in system
    -t: number of tests
    -p: percentage of memory to occupy
    -r: random page
    -m: phy_memory_in_gigs
    -g: flip goal (1|0); 1: 0&rarr;1 flip and 0: 1&rarr;0 flip
    -i: bit profile path (0 to 1 flip)
    -j: bit profile path (1 to 0 flip)
    -a: target address to hammer (in hex)
    -T: number of reads for each hammer term (x Millions)]
    -V: verbose level
    -f: page content file
    -F: file bit offset for retest
    -P: page index
    -I: number of times a page would be tested for leakage

### Example usage

```bash
sudo ./rh-leakage-haswell -d 1 -p 0.5 -g 0 -i bfp_example_0.dat  -j bfp_example_1.dat  -r 200  -T 1.0 -t 10 -I 50
```
